import{r as d,j as e}from"./vendor-77yDWcJJ.js";import{C as P}from"./Card-B3nxRyRw.js";import{B as v}from"./Button-CI2oUu3j.js";import{a as S,u as F,e as k,d as U,g as E,h as L,i as V}from"./index-CrqZLxMN.js";import{g as $,X as q,d as D,V as X,h as H}from"./icons-DL2PgYE_.js";import{f as J,a as Q,c as W}from"./fallback_m-DD1dC9O4.js";import{m as A,A as Y}from"./motion-KXh7TDlr.js";import"./firebase-DCzW8K6T.js";import"./router-YYQTkf18.js";const Z=({supportUrl:o})=>{const{t:s}=S(),[a,t]=d.useState(!1),p=!!(o&&o.trim().length>0),i=!p&&!1;return d.useEffect(()=>{if(!a)return;const u=f=>{f.key==="Escape"&&t(!1)};return window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[a]),e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"bg-white/80",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold text-[#0f172a]",children:s("support.title","Sostieni Loom")}),e.jsx("p",{className:"text-sm text-[#64748b]",children:s("support.body.line1")}),e.jsx("p",{className:"text-sm text-[#64748b]",children:s("support.body.line2")})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[p?e.jsx("a",{href:o,target:"_blank",rel:"noreferrer","aria-label":s("support.cta","Offrimi un caffè ☕"),children:e.jsx(v,{variant:"secondary",className:"rounded-full",children:s("support.cta","Offrimi un caffè ☕")})}):e.jsx(v,{variant:"secondary",className:"rounded-full opacity-60",disabled:!0,children:s("support.cta","Offrimi un caffè ☕")}),e.jsx("button",{type:"button",onClick:()=>t(!0),className:"text-[11px] font-semibold text-[#94a3b8] hover:text-[#64748b] transition duration-[120ms]",children:s("support.what","Cosa finanzia?")})]}),(p||i)&&e.jsx("p",{className:"text-[10px] text-[#94a3b8]/70",children:p?s("support.external","Apri un link esterno"):s("support.missing","Link non configurato")})]})}),a&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/35 px-4",onClick:()=>t(!1),children:e.jsxs("div",{className:"w-full max-w-sm rounded-[18px] border border-[rgba(0,0,0,0.06)] bg-white p-5 shadow-[0_30px_80px_-60px_rgba(15,23,42,0.45)]",onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{size:14,className:"text-[#94a3b8]"}),e.jsx("p",{className:"text-sm font-semibold text-[#0f172a]",children:s("support.modal.title","Cosa finanzia?")})]}),e.jsx("button",{type:"button","aria-label":s("common.close","Chiudi"),onClick:()=>t(!1),className:"rounded-full p-1 text-[#94a3b8] hover:text-[#64748b]",children:e.jsx(q,{size:16})})]}),e.jsxs("ul",{className:"mt-3 list-disc space-y-2 pl-5 text-sm text-[#64748b]",children:[e.jsx("li",{children:s("support.modal.bullet1")}),e.jsx("li",{children:s("support.modal.bullet2")}),e.jsx("li",{children:s("support.modal.bullet3")})]})]})})]})},ce=()=>{const{user:o,signOut:s}=F(),{t:a}=S(),t=o?.email||o?.uid||"guest";return e.jsx(K,{user:o,signOut:s,t:a,profileKey:t,supportUrl:""},t)},K=({user:o,signOut:s,t:a,profileKey:t,supportUrl:p})=>{const[i,u]=d.useState(()=>k(t)),[f,b]=d.useState(()=>U(t)),[O,w]=d.useState(()=>E(t)),[z,g]=d.useState(!1),N=d.useRef(null);d.useEffect(()=>{const r=m=>{const l=m.detail;!l||l.profile!==t||u(k(t))};return window.addEventListener("ws-items-updated",r),()=>window.removeEventListener("ws-items-updated",r)},[t]),d.useEffect(()=>{const r=m=>{const l=m.detail;!l||l.profile!==t||((l.gender==="female"||l.gender==="male")&&b(l.gender),(typeof l.avatar=="string"||l.avatar===null)&&(w(E(t)),g(!1)))};return window.addEventListener("ws-profile-updated",r),()=>window.removeEventListener("ws-profile-updated",r)},[t]);const y=f==="male"?J:Q,M=z?y:O||o?.picture||y,I=()=>{N.current?.click()},_=async r=>{const m=r.target.files?.[0];if(m)try{const{dataUrl:l}=await W(m);w(l),g(!1),V(t,l)}catch{}},x=d.useMemo(()=>{if(!i.length)return{total:0,topCategory:"—",topTag:"—",topSeason:"—"};const r=n=>Object.entries(n.reduce((c,h)=>(c[h]=(c[h]||0)+1,c),{})).sort((c,h)=>h[1]-c[1])[0]?.[0]||"—",m=r(i.map(n=>n.category)),l=r(i.map(n=>n.season)),T=r(i.flatMap(n=>n.tags||[])),B=Object.entries(i.reduce((n,c)=>(n[c.color]=(n[c.color]||0)+1,n),{})).sort((n,c)=>c[1]-n[1]),[G,j]=B[0]||["",0],C=j/i.length,R=j>=3&&C>=.3?a("profile.stat.redundancy","Colore prevalente: {count} capi {color} ({percent}%).",{count:j,color:G.toLowerCase(),percent:Math.round(C*100)}):null;return{total:i.length,topCategory:m,topTag:T,topSeason:l,redundancy:R}},[i,a]);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(P,{className:"bg-white/90",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative h-24 w-24",children:[e.jsx("div",{className:"h-full w-full overflow-hidden rounded-full border border-[#e2e8f0] bg-white",children:e.jsx("img",{src:M,alt:a("profile.avatarAlt","Avatar profilo"),className:"h-full w-full object-cover",onError:()=>g(!0)})}),e.jsx("button",{type:"button",onClick:I,"aria-label":a("profile.avatar.change","Cambia foto profilo"),className:"absolute -bottom-1 -right-1 flex h-9 w-9 items-center justify-center rounded-full border border-[#e2e8f0] bg-white text-[#475569] shadow-sm transition duration-[120ms] hover:text-[#0f172a]",children:e.jsx(D,{size:16})}),e.jsx("input",{ref:N,type:"file",accept:"image/*",className:"hidden",onChange:_})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm uppercase tracking-[0.3em] text-[#94a3b8]",children:a("profile.title","Profilo")}),e.jsx("p",{className:"text-lg font-semibold text-[#0f172a]",children:o?.name||"Ospite"}),e.jsx("p",{className:"text-sm text-[#475569]",children:o?.email||"guest@example.com"})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:`flex h-7 w-7 items-center justify-center rounded-full border text-[#475569] transition ${f==="female"?"border-transparent bg-[#0f172a] text-white":"border-[#e2e8f0] bg-white"}`,"aria-label":a("profile.gender.female","Donna"),onClick:()=>{b("female"),L(t,"female")},children:e.jsx(X,{size:12})}),e.jsx("button",{type:"button",className:`flex h-7 w-7 items-center justify-center rounded-full border text-[#475569] transition ${f==="male"?"border-transparent bg-[#0f172a] text-white":"border-[#e2e8f0] bg-white"}`,"aria-label":a("profile.gender.male","Uomo"),onClick:()=>{b("male"),L(t,"male")},children:e.jsx(H,{size:12})})]}),e.jsx(v,{variant:"ghost",className:"rounded-full px-4 text-[#ef4444] hover:text-[#b91c1c]",onClick:s,children:a("profile.logout","Logout")})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-4",children:[{label:a("profile.stat.total","Capi totali"),value:x.total},{label:a("profile.stat.cat","Categoria più frequente"),value:x.topCategory},{label:a("profile.stat.tag","Tag più usato"),value:x.topTag},{label:a("profile.stat.season","Stagione top"),value:x.topSeason}].map(r=>e.jsx(A.div,{layout:!0,initial:{opacity:.8,scale:.99},animate:{opacity:1,scale:1},transition:{duration:.12},className:"rounded-2xl border border-[#e6e6e8] bg-white/80 p-3 shadow-sm",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("p",{className:"min-h-[32px] text-[12px] uppercase tracking-[0.3em] text-[#94a3b8] sm:text-[13px] leading-tight",children:r.label}),r.value==="—"?e.jsx("p",{className:"mt-auto text-sm text-[#94a3b8] italic",children:a("profile.stat.empty","Non disponibile")}):e.jsx("p",{className:"mt-auto text-base font-medium text-[#0f172a]",children:r.value})]})},r.label))}),e.jsx(Y,{children:x.redundancy&&e.jsx(A.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:6},transition:{duration:.18},className:"rounded-2xl border border-[#e6e6e8] bg-white/80 px-3 py-2 text-sm text-[#475569]",children:x.redundancy})})]}),e.jsx("div",{className:"pt-2",children:e.jsx(Z,{supportUrl:p})})]})};export{ce as ProfilePage};
