const i=t=>new Promise((r,o)=>{const a=new FileReader;a.onload=()=>r(a.result),a.onerror=o,a.readAsDataURL(t)}),g=(t,r,o)=>new Promise((a,n)=>t.toBlob(e=>{if(!e){n(new Error("Canvas blob not available"));return}i(e).then(a).catch(n)},r,o)),h=async(t,{maxSize:r=1280,quality:o=.76}={})=>{const a=await createImageBitmap(t),n=Math.min(r/a.width,r/a.height,1),e=Math.round(a.width*n),c=Math.round(a.height*n),s=document.createElement("canvas");s.width=e,s.height=c;const l=s.getContext("2d");if(!l)throw new Error("Canvas context not available");l.drawImage(a,0,0,e,c);const d=await new Promise(w=>s.toBlob(b=>w(b||t),"image/webp",o)),m=await g(s,"image/webp",o);return{blob:d,dataUrl:m}},p=async t=>t,u=async(t,r)=>{const o=new FormData;o.append("image",t);const a=await fetch(`https://api.imgbb.com/1/upload?key=${r}`,{method:"POST",body:o});if(!a.ok)throw new Error("Upload imgbb fallito");const e=(await a.json())?.data;return{url:e?.url,provider:"imgbb",providerId:e?.id,deleteUrl:e?.delete_url,uploadedAt:new Date().toISOString()}},f=async(t,r)=>{let o=t;r?.removeBackground&&(o=await p(t));const a="e58ef7804f54eead7b9269e7677387cf";try{return await u(o,a)}catch(e){console.warn("Upload imgbb fallito, uso provider local",e)}return{url:await i(o),provider:"local",uploadedAt:new Date().toISOString()}},v="/Loom-Studio/assets/fallback_f-axWJyrnx.png",U="/Loom-Studio/assets/fallback_m-CaT4aWd5.png";export{v as a,h as c,U as f,p as r,f as u};
